# 膳食计划生成器 - 问题描述

## 项目背景

马来西亚膳食计划生成器，使用豆包 AI 生成个性化的 7 天膳食计划和购物清单。

---

## 技术环境

| 项目 | 详情 |
|-----|------|
| 前端框架 | Next.js 14 (App Router) |
| 部署平台 | Vercel Pro（$20/月） |
| AI 服务 | 豆包 Doubao API |
| AI 模型 | doubao-seed-1-6-lite-251015 |
| API 端点 | https://ark.cn-beijing.volces.com/api/v3/chat/completions |
| 数据库 | Supabase |

---

## 问题1：膳食计划生成超时（已解决）

### 现象
调用豆包 AI 一次性生成 7 天膳食计划时，返回 504 Gateway Timeout。

### 原因
- Vercel Pro 函数最大执行时间：**60 秒**
- 豆包 AI 生成 7 天计划需要：**100-127 秒**

### 已采用的解决方案
将 1 次请求拆分成 7 次，每次只生成 1 天的膳食计划。每次请求约 10-20 秒，不会超时。

---

## 问题2：购物清单生成超时（未解决）

### 现象
膳食计划生成成功后，调用豆包 AI 生成购物清单时，返回 504 Gateway Timeout。

```
POST /api/generate-shopping-list 504 (Gateway Timeout)
```

### 原因
购物清单需要根据 7 天 21 餐的菜品汇总生成食材列表，AI 处理时间超过 60 秒。

### 约束条件
- 购物清单必须一次性生成（需要汇总去重）
- 不能像膳食计划那样拆分成 7 天分别生成
- Vercel Pro 最大执行时间只有 60 秒

### 当前状态
膳食计划可以正常生成和保存，但购物清单无法生成。

---

## 问题3：生成的膳食每天内容相同

### 现象
AI 生成的 7 天膳食计划，每天的早餐、午餐、晚餐都是相同的菜品。

### 原因
Prompt 中给了示例 JSON，AI 直接复制示例内容而不是自己生成多样化的菜品。

### 当前状态
已简化 Prompt，移除了具体示例，让 AI 自己生成。待验证效果。

---

## 核心问题总结

**豆包 AI 响应时间过长，超过 Vercel 的 60 秒函数执行时间限制。**

膳食计划可以通过拆分请求解决，但购物清单因为需要汇总处理，无法拆分，仍然会超时。
