# 膳食计划生成器 - 问题描述

## 问题现象

调用豆包 AI API 生成膳食计划时，Vercel 返回 **504 Gateway Timeout** 错误。

```
错误信息：FUNCTION_INVOCATION_TIMEOUT
HTTP 状态码：504
```

---

## 技术环境

- **前端框架**：Next.js 14 (App Router)
- **部署平台**：Vercel Pro（$20/月）
- **AI 服务**：豆包 Doubao API
- **AI 模型**：doubao-seed-1-6-lite-251015
- **API 端点**：https://ark.cn-beijing.volces.com/api/v3/chat/completions

---

## 问题原因

| 限制 | 数值 |
|-----|------|
| Vercel Pro 函数最大执行时间 | **60 秒** |
| 豆包 AI 实际响应时间 | **100-127 秒** |

豆包 AI 生成完整的 7 天膳食计划需要 100+ 秒，超过了 Vercel 的 60 秒函数执行时间限制。

---

## 请求内容

让 AI 生成 7 天马来西亚膳食计划（每天 3 餐，共 21 餐），返回 JSON 格式。

**Prompt 示例**：
```
为30岁男（目标：健康饮食）生成7天马来西亚膳食计划。

返回JSON格式：
{"plan":[{"day":"Monday","meals":{"breakfast":{"name_zh":"椰浆饭","name_en":"Nasi Lemak"},"lunch":{"name_zh":"炒粿条","name_en":"Char Kway Teow"},"dinner":{"name_zh":"肉骨茶","name_en":"Bak Kut Teh"}}},...]}

只返回7天计划，每天3餐。
```

---

## 已配置

- `export const maxDuration = 60`（Vercel 函数配置）
- `max_tokens: 1000`
- `stream: true`（流式输出）
- `temperature: 0.7`

---

## 测试数据

本地测试豆包 API 响应时间：
- 第一次：113,023 毫秒（约 113 秒）
- 第二次：127,206 毫秒（约 127 秒）

Vercel 线上测试：
- 等待 61.38 秒后返回 504 超时错误

