# ğŸ”„ Malaysia Meal Planner é¡¹ç›®çŠ¶æ€äº¤æ¥æ–‡æ¡£

**æ—¥æœŸ**: 2026-01-08  
**é¡¹ç›®**: MYMeal AI - é©¬æ¥è¥¿äºšæ™ºèƒ½è†³é£Ÿè§„åˆ’ç³»ç»Ÿ  
**çŠ¶æ€**: å·²éƒ¨ç½²åˆ° Vercelï¼Œå‰ç«¯æ˜¾ç¤º"æœªçŸ¥é£Ÿæ"é—®é¢˜å¾…è§£å†³

---

## ğŸ“‹ é¡¹ç›®åŸºæœ¬ä¿¡æ¯

### éƒ¨ç½²ä¿¡æ¯
- **GitHub ä»“åº“**: `https://github.com/huhaotian5/malaixiya`
- **Vercel éƒ¨ç½²**: å·²æˆåŠŸéƒ¨ç½²å¹¶è¿è¡Œ
- **æœ€åæ¨é€æ—¶é—´**: 2026-01-08 (å·²åŒ…å«è´­ç‰©æ¸…å•æ˜¾ç¤ºä¿®å¤)

### æŠ€æœ¯æ ˆ
- **å‰ç«¯æ¡†æ¶**: Next.js 14 (App Router)
- **æ•°æ®åº“**: Supabase (PostgreSQL)
- **AI æœåŠ¡**: è±†åŒ… (Doubao) API
- **éƒ¨ç½²å¹³å°**: Vercel
- **è¯­è¨€**: TypeScript, React

---

## âœ… å·²å®Œæˆçš„é…ç½®

### 1. Supabase é…ç½®
**æ•°æ®åº“å·²æ­£ç¡®åˆå§‹åŒ–**ï¼ŒåŒ…å«ä»¥ä¸‹è¡¨ï¼š
- `user_profiles` - ç”¨æˆ·æ¡£æ¡ˆ
- `dietary_restrictions` - é¥®é£Ÿé™åˆ¶
- `recipes` - é£Ÿè°±æ•°æ®ï¼ˆ90æ¡é©¬æ¥è¥¿äºšç¾é£Ÿï¼‰
- `meal_plans` - è†³é£Ÿè®¡åˆ’
- `meal_plan_details` - è†³é£Ÿè®¡åˆ’è¯¦æƒ…
- `shopping_lists` - è´­ç‰©æ¸…å•
- `shopping_list_items` - è´­ç‰©æ¸…å•é¡¹ç›®

**é‡è¦é…ç½®**ï¼š
- âœ… å·²å¯ç”¨ Anonymous Sign-ins
- âœ… å·²æ‰§è¡Œ `schema.sql`
- âœ… å·²æ‰§è¡Œ `seed-recipes.sql`

### 2. Vercel ç¯å¢ƒå˜é‡
æ‰€æœ‰ç¯å¢ƒå˜é‡å·²æ­£ç¡®é…ç½®ï¼š

```bash
# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://wpabckyfygfvghslzjnl.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=[ç”¨æˆ·çš„ Supabase Anon Key]

# Doubao AI
DOUBAO_API_ENDPOINT=https://ark.cn-beijing.volces.com/api/v3/chat/completions
DOUBAO_API_KEY=[ç”¨æˆ·çš„æ­£ç¡®API Keyï¼Œå·²éªŒè¯æœ‰æ•ˆ]
DOUBAO_MODEL=doubao-seed-1-6-lite-251015
```

**æ³¨æ„**: ç”¨æˆ·ä¹‹å‰ä½¿ç”¨äº†é”™è¯¯çš„ API Keyï¼ˆAccess Key è€Œé API Keyï¼‰ï¼Œç°å·²ä¿®å¤ã€‚

---

## ğŸ¯ å·²ä¿®å¤çš„é—®é¢˜

### 1. GitHub æ¨é€é—®é¢˜ âœ…
**é—®é¢˜**: GitHub Secret Scanning æ£€æµ‹åˆ°è„šæœ¬ä¸­çš„ token å¹¶é˜»æ­¢æ¨é€  
**è§£å†³**: ä½¿ç”¨ Personal Access Token (PAT) å¹¶æ¸…ç† Git å†å²

### 2. Vercel ä»“åº“ä¸ºç©ºé—®é¢˜ âœ…
**é—®é¢˜**: Vercel æ˜¾ç¤º "repository rule violation"  
**è§£å†³**: æˆåŠŸæ¨é€ä»£ç åˆ° GitHub å¹¶åœ¨ Vercel ä¸­å®Œæˆéƒ¨ç½²

### 3. Supabase é…ç½®é”™è¯¯ âœ…
**é—®é¢˜**: ä½¿ç”¨äº† Dashboard URL è€Œé Project API URL  
**è§£å†³**: æ›´æ­£ä¸º `https://bvhjtwodlrmhsmacctfu.supabase.co`

### 4. Doubao API 401 é”™è¯¯ âœ…
**é—®é¢˜**: ä½¿ç”¨äº†é”™è¯¯çš„ API Key ç±»å‹ï¼ˆAccess Keyï¼‰  
**è§£å†³**: ç”¨æˆ·æ‰¾åˆ°äº†æ­£ç¡®çš„ Doubao API Key

### 5. JSON è§£æé”™è¯¯ï¼ˆtrailing commasï¼‰âœ…
**é—®é¢˜**: Doubao API è¿”å›çš„ JSON åŒ…å« trailing commas å¯¼è‡´è§£æå¤±è´¥  
**è§£å†³**: æ·»åŠ  `cleanJsonString` å‡½æ•°æ¸…ç† JSON

### 6. è´­ç‰©æ¸…å•ç”Ÿæˆæ…¢/è¶…æ—¶ âœ…
**é—®é¢˜**: è´­ç‰©æ¸…å•å•ç‹¬ç”Ÿæˆï¼Œéœ€è¦é¢å¤–ç­‰å¾…æ—¶é—´  
**è§£å†³**: åˆå¹¶è†³é£Ÿè®¡åˆ’å’Œè´­ç‰©æ¸…å•ç”Ÿæˆä¸ºä¸€æ¬¡ API è°ƒç”¨

### 7. æµå¼è¾“å‡ºä¼˜åŒ– âœ…
**é—®é¢˜**: éæµå¼è¾“å‡ºå¯¼è‡´ç”¨æˆ·ä½“éªŒå·®  
**è§£å†³**: å¯ç”¨ Doubao API çš„ `stream: true` å‚æ•°

### 8. 20ç§’ç­‰å¾…æ—¶é—´ç§»é™¤ âœ…
**é—®é¢˜**: è´­ç‰©æ¸…å•é¡µé¢æœ‰ä¸å¿…è¦çš„ 20 ç§’ç­‰å¾…  
**è§£å†³**: ç§»é™¤è½®è¯¢é€»è¾‘ï¼Œç›´æ¥åŠ è½½æ•°æ®åº“ä¸­çš„è´­ç‰©æ¸…å•

---

## âŒ å½“å‰å¾…è§£å†³çš„é—®é¢˜

### ğŸ”´ ä¸»è¦é—®é¢˜ï¼šè´­ç‰©æ¸…å•æ˜¾ç¤º"æœªçŸ¥é£Ÿæ"

**ç°è±¡**:
- å‰ç«¯è´­ç‰©æ¸…å•é¡µé¢æ˜¾ç¤ºæ‰€æœ‰é£Ÿæä¸º"æœªçŸ¥é£Ÿæ"
- ä½†æ•°æ®åº“ä¸­çš„æ•°æ®æ˜¯æ­£ç¡®çš„ï¼ˆè§ä¸‹æ–¹æ•°æ®éªŒè¯ï¼‰

**å·²éªŒè¯çš„äº‹å®**:
1. âœ… æ•°æ®åº“ `shopping_list_items` è¡¨ä¸­æœ‰ `notes` å­—æ®µ
2. âœ… `notes` å­—æ®µåŒ…å«æ­£ç¡®çš„æ•°æ®æ ¼å¼ï¼š`åœŸè±† | Potato | Kentang`
3. âœ… æ•°æ®æ˜¯æœ€æ–°çš„ï¼ˆ2026-01-08ï¼Œæ—¶åŒºæ˜¾ç¤ºä¸º 2026-01-07ï¼‰
4. âœ… ä»£ç å·²ä¿®å¤å¹¶æ¨é€åˆ° GitHub

**æ•°æ®åº“å®é™…æ•°æ®ç¤ºä¾‹**ï¼ˆä» Supabase æˆªå›¾ï¼‰:
```
notes åˆ—çš„å€¼ï¼š
- åœŸè±† | Potato | Kentang
- é•¿ç²’ç±³ | Long Grain Rice | Beras panjang
- å§œ | Ginger | Halba
- è‘±æ²¹ | Onion Oil | Minyak Bawang
- é¦™èœ | Coriander | Daun Ketumbar
- ç²‰ä¸ | Glass Noodle | Soun
- æ™®é€šå¤§ç±³ | Regular Rice | Beras Biasa
- ç•ªèŒ„ | Tomato | Tomato
- é»„é¢ | Yellow Noodles | Mee Kuning
- èŠ±ç”Ÿé…± | Peanut Sauce | Sos Kacang
- é¸¡è›‹ | Egg | Telur
- æ¤°æµ† | Coconut Milk | [æˆªæ–­]
- è™¾ | Prawn | Udang
- é¢ç²‰ | Flour | Tepung
- é…±æ²¹ | Soy Sauce | Sos Soya
```

**å·²å®æ–½çš„ä¿®å¤ä»£ç **:

æ–‡ä»¶: `src/components/shopping/ShoppingListView.tsx` (ç¬¬ 192-196 è¡Œ)
```typescript
{/* ä¼˜å…ˆä½¿ç”¨ notes å­—æ®µï¼ˆAI ç”Ÿæˆçš„é£Ÿæåï¼‰ï¼Œå¦åˆ™ç”¨ ingredient å…³è”çš„é£Ÿæ */}
{item.notes?.split('|')[0]?.trim() || 
 item.ingredient?.name_zh || 
 item.ingredient?.name_ms || 
 item.ingredient?.name_en || 
 'æœªçŸ¥é£Ÿæ'}
```

**è°ƒè¯•æ—¥å¿—**:
å·²åœ¨ `src/components/shopping/ShoppingListView.tsx` ç¬¬ 175 è¡Œæ·»åŠ ï¼š
```typescript
console.log('ğŸ› Debug item:', {
  id: item.id,
  notes: item.notes,
  category: item.category,
  quantity: item.quantity,
  unit: item.unit,
  ingredient: item.ingredient
});
```

**ç”¨æˆ·åé¦ˆ**:
- ç”Ÿæˆæ—¥å¿—ä¸­**æ²¡æœ‰çœ‹åˆ°** `ğŸ“¦ Item 1:` å’Œ `ğŸ“ Item notes:` æ—¥å¿—
- è¿™äº›æ—¥å¿—åœ¨ `src/app/page.tsx` çš„ `saveShoppingListFromAI` å‡½æ•°ä¸­ï¼ˆç¬¬ 25-31 è¡Œï¼‰
- è¯´æ˜å¯èƒ½æ˜¯ Vercel éƒ¨ç½²æœªå®Œæˆæˆ–å‰ç«¯ç¼“å­˜é—®é¢˜

---

## ğŸ“ å…³é”®æ–‡ä»¶çŠ¶æ€

### 1. API è·¯ç”±
**æ–‡ä»¶**: `src/app/api/generate-meal-plan/route.ts`  
**çŠ¶æ€**: âœ… å·²å®Œæˆæ‰€æœ‰ä¼˜åŒ–
- æµå¼è¾“å‡º
- å•æ¬¡è°ƒç”¨åŒæ—¶ç”Ÿæˆè†³é£Ÿè®¡åˆ’å’Œè´­ç‰©æ¸…å•
- `cleanJsonString` æ¸…ç† trailing commas
- æœ¬åœ°ç®—æ³• fallback
- `maxDuration = 60` ç§’
- `max_tokens = 1500`

**Prompt ä¼˜åŒ–**ï¼ˆç¬¬ 38-48 è¡Œï¼‰:
```typescript
const prompt = `ä¸º${userProfile.age}å²${userProfile.gender}ï¼ˆç›®æ ‡ï¼š${userProfile.health_goal}${restrictions && restrictions.length > 0 ? `ï¼Œé™åˆ¶ï¼š${restrictions.join('ã€')}` : ''}ï¼‰ç”Ÿæˆ7å¤©é©¬æ¥è¥¿äºšè†³é£Ÿè®¡åˆ’å’Œè´­ç‰©æ¸…å•ã€‚

è¦æ±‚ï¼š
1. è†³é£Ÿè®¡åˆ’æ¯å¤©å«æ—©åˆæ™šé¤ï¼Œè¥å…»å‡è¡¡ï¼Œèœå“å¤šæ ·ï¼Œä½¿ç”¨çœŸå®é©¬æ¥è¥¿äºšç¾é£Ÿåç§°ã€‚
2. è´­ç‰©æ¸…å•ä¸º4äººä»½ï¼Œä¸€å‘¨ç”¨é‡ï¼Œåˆå¹¶ç›¸åŒé£Ÿæï¼Œä¼°ç®—é©¬æ¥è¥¿äºšå¸‚åœºä»·æ ¼(RM)ï¼ŒæŒ‰ç±»åˆ«åˆ†ç»„ã€‚
3. ç±»åˆ«åªèƒ½æ˜¯ï¼šæ–°é²œè”¬èœã€è‚‰ç±» & æµ·é²œã€è°ƒå‘³æ–™ã€è°·ç‰© & ä¸»é£Ÿã€æ°´æœã€å…¶ä»–ã€‚

è¿”å›JSONï¼ˆç´§å‡‘æ ¼å¼ï¼Œä¸è¦markdownä»£ç å—ï¼‰ï¼š
{"plan":[{"day":"Monday","meals":{"breakfast":{"name_zh":"æ¤°æµ†é¥­","name_en":"Nasi Lemak"},"lunch":{"name_zh":"ç‚’ç²¿æ¡","name_en":"Char Kway Teow"},"dinner":{"name_zh":"è‚‰éª¨èŒ¶","name_en":"Bak Kut Teh"}}},...6å¤©],"shopping_list":[{"name":"å¤§ç±³","name_en":"Rice","category":"è°·ç‰© & ä¸»é£Ÿ","quantity":3000,"unit":"g","price":12},...å…¶ä»–]}
`;
```

### 2. å‰ç«¯é¡µé¢
**æ–‡ä»¶**: `src/app/page.tsx`  
**çŠ¶æ€**: âœ… å·²ä¼˜åŒ–
- ç§»é™¤äº†å•ç‹¬çš„è´­ç‰©æ¸…å• API è°ƒç”¨
- åœ¨ `saveShoppingListFromAI` å‡½æ•°ä¸­ä¿å­˜ AI è¿”å›çš„è´­ç‰©æ¸…å•
- `notes` å­—æ®µæ ¼å¼ï¼š`${itemName} | ${itemEn} | ${itemMs}`

**å…³é”®ä»£ç **ï¼ˆç¬¬ 25-31 è¡Œï¼‰:
```typescript
const itemName = item.name || 'æœªçŸ¥';
const itemEn = item.name_en || '';
const itemMs = item.name_ms || '';
const notesContent = `${itemName} | ${itemEn} | ${itemMs}`;

console.log(`ğŸ“¦ Item ${index + 1}:`, item);
console.log(`ğŸ“ Item notes: ${notesContent}`);
```

### 3. è´­ç‰©æ¸…å•é¡µé¢
**æ–‡ä»¶**: `src/app/shopping-list/page.tsx`  
**çŠ¶æ€**: âœ… å·²ç®€åŒ–
- ç§»é™¤äº† 20 ç§’ç­‰å¾…å’Œè½®è¯¢é€»è¾‘
- ç›´æ¥ä»æ•°æ®åº“åŠ è½½æœ€æ–°çš„è´­ç‰©æ¸…å•

### 4. è´­ç‰©æ¸…å•ç»„ä»¶
**æ–‡ä»¶**: `src/components/shopping/ShoppingListView.tsx`  
**çŠ¶æ€**: âœ… å·²ä¿®å¤
- ä¼˜å…ˆä½¿ç”¨ `item.notes` å­—æ®µæ˜¾ç¤ºé£Ÿæåç§°
- æ·»åŠ äº†è°ƒè¯•æ—¥å¿—

---

## ğŸ—„ï¸ æ•°æ®åº“çŠ¶æ€

### æœ€æ–°è´­ç‰©æ¸…å•æ•°æ®
**è¡¨**: `shopping_list_items`  
**åˆ›å»ºæ—¶é—´**: 2026-01-08 06:15:06 (UTC) / 2026-01-07 (ç¾å›½æ—¶é—´)  
**æ•°æ®é‡**: çº¦ 15-20 æ¡

**å­—æ®µç»“æ„**:
- `id` (uuid): ä¸»é”®
- `shopping_list_id` (uuid): å…³è”è´­ç‰©æ¸…å•
- `ingredient_id` (uuid): **NULL**ï¼ˆAI ç”Ÿæˆçš„é£Ÿæä¸å…³è” ingredients è¡¨ï¼‰
- `quantity` (numeric): æ•°é‡
- `unit` (text): å•ä½
- `category` (text): åˆ†ç±»ï¼ˆæ–°é²œè”¬èœã€è‚‰ç±» & æµ·é²œç­‰ï¼‰
- `estimated_price` (numeric): ä¼°ç®—ä»·æ ¼
- `is_purchased` (boolean): æ˜¯å¦å·²è´­ä¹°
- `notes` (text): **å…³é”®å­—æ®µ**ï¼Œæ ¼å¼ä¸º `ä¸­æ–‡å | English | Bahasa Malaysia`
- `created_at` (timestamptz): åˆ›å»ºæ—¶é—´

**é‡è¦**: `ingredient_id` ä¸º `NULL` æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸º AI ç”Ÿæˆçš„é£Ÿæä¸éœ€è¦å…³è”æ•°æ®åº“ä¸­çš„ `ingredients` è¡¨ã€‚


## ğŸ”§ å¿«é€Ÿè¯Šæ–­å‘½ä»¤

### Supabase SQL æŸ¥è¯¢
åœ¨ Supabase SQL Editor ä¸­è¿è¡Œä»¥ä¸‹æŸ¥è¯¢æ¥éªŒè¯æ•°æ®ï¼š

```sql
-- æŸ¥çœ‹æœ€æ–°çš„è´­ç‰©æ¸…å•
SELECT sl.id, sl.created_at, sl.meal_plan_id
FROM shopping_lists sl
ORDER BY sl.created_at DESC
LIMIT 1;

-- æŸ¥çœ‹æœ€æ–°è´­ç‰©æ¸…å•çš„æ‰€æœ‰é¡¹ç›®
SELECT 
  sli.id,
  sli.notes,
  sli.category,
  sli.quantity,
  sli.unit,
  sli.estimated_price,
  sli.ingredient_id,
  sli.created_at
FROM shopping_list_items sli
JOIN shopping_lists sl ON sli.shopping_list_id = sl.id
WHERE sl.id = (
  SELECT id FROM shopping_lists 
  ORDER BY created_at DESC 
  LIMIT 1
)
ORDER BY sli.category, sli.created_at;

-- æ£€æŸ¥æœ‰å¤šå°‘é¡¹ç›®çš„ notes å­—æ®µä¸ºç©º
SELECT 
  COUNT(*) as total_items,
  COUNT(notes) as items_with_notes,
  COUNT(*) - COUNT(notes) as items_without_notes
FROM shopping_list_items sli
JOIN shopping_lists sl ON sli.shopping_list_id = sl.id
WHERE sl.id = (
  SELECT id FROM shopping_lists 
  ORDER BY created_at DESC 
  LIMIT 1
);
```

---

## ğŸ“ ç”¨æˆ·åé¦ˆå†å²

### æœ€è¿‘çš„ç”¨æˆ·æ¶ˆæ¯
1. "ä¸ºä»€ä¹ˆè¿™é‡Œéƒ½æ˜¯æœªçŸ¥é£Ÿæ" - æŠ¥å‘Šé—®é¢˜
2. "è¿˜æ˜¯æœªçŸ¥é£Ÿæ" - ç¬¬ä¸€æ¬¡ä¿®å¤åæœªç”Ÿæ•ˆ
3. "è¿™æ˜¯å…¨éƒ¨çš„ç”Ÿæˆæ—¥å¿—ï¼Œæˆ‘æ²¡æ‰¾åˆ°ä½ è¯´çš„è¿™ä¸¤è¡Œ" - æ—¥å¿—ä¸­ç¼ºå°‘ `ğŸ“¦ Item` å’Œ `ğŸ“ Item notes` æ—¥å¿—
4. "æ•°æ®æ˜¯æ–°çš„ï¼Œä¸ƒå·æ˜¯å› ä¸ºæ˜¾ç¤ºçš„æ˜¯ç¾å›½æ—¶é—´å§" - ç¡®è®¤æ•°æ®åº“æ•°æ®æ˜¯æ–°çš„

### ç”¨æˆ·çš„ Supabase æˆªå›¾å†…å®¹
ä»æˆªå›¾å¯ä»¥çœ‹åˆ° `shopping_list_items` è¡¨çš„ `notes` åˆ—æœ‰ä»¥ä¸‹å€¼ï¼ˆéƒ¨åˆ†ï¼‰ï¼š
- åœŸè±† | Potato | Kentang
- é•¿ç²’ç±³ | Long Grain Rice | Beras panjang
- å§œ | Ginger | Halba
- è‘±æ²¹ | Onion Oil | Minyak Bawang
- ç•ªèŒ„ | Tomato | Tomato
- é…±æ²¹ | Soy Sauce | Sos Soya
- ç­‰ç­‰...

**æ‰€æœ‰æ•°æ®æ ¼å¼éƒ½æ˜¯æ­£ç¡®çš„ï¼**

---
---

## ğŸ“Œ é‡è¦æé†’

1. **Git å’Œ GitHub å·²é…ç½®å®Œæˆ**ï¼Œæ— éœ€å†å¤„ç†è®¤è¯é—®é¢˜
2. **Vercel ç¯å¢ƒå˜é‡å·²å®Œæ•´é…ç½®**ï¼Œæ‰€æœ‰å€¼éƒ½æ˜¯æ­£ç¡®çš„
3. **æ•°æ®åº“æ•°æ®æ˜¯æ­£ç¡®çš„**ï¼Œ`notes` å­—æ®µæœ‰å€¼
4. **ä»£ç ä¿®å¤æ˜¯æ­£ç¡®çš„**ï¼Œå·²æ¨é€åˆ° GitHub
5. **ä¸»è¦æ€€ç–‘æ˜¯ Vercel éƒ¨ç½²ç¼“å­˜æˆ–æµè§ˆå™¨ç¼“å­˜**
---

## ğŸ¯ æ€»ç»“

**é¡¹ç›®æ•´ä½“çŠ¶æ€**: âœ… 95% å®Œæˆ  
**å‰©ä½™é—®é¢˜**: âŒ å‰ç«¯æ˜¾ç¤º"æœªçŸ¥é£Ÿæ"ï¼ˆå¾ˆå¯èƒ½æ˜¯éƒ¨ç½²ç¼“å­˜é—®é¢˜ï¼‰  
**ä»£ç çŠ¶æ€**: âœ… æ‰€æœ‰ä¿®å¤å·²å®Œæˆå¹¶æ¨é€  
**æ•°æ®åº“çŠ¶æ€**: âœ… æ•°æ®å®Œæ•´ä¸”æ ¼å¼æ­£ç¡®  
**ä¸‹ä¸€æ­¥**: éªŒè¯ Vercel éƒ¨ç½²å®Œæˆ + æ¸…é™¤æµè§ˆå™¨ç¼“å­˜

**å¦‚æœç¡¬åˆ·æ–°åè¿˜æ˜¯ä¸è¡Œï¼Œé‡ç‚¹æ£€æŸ¥**:
1. Vercel éƒ¨ç½²æ—¶é—´æˆ³
2. æµè§ˆå™¨æ§åˆ¶å°çš„ `ğŸ› Debug item:` æ—¥å¿—
3. å‰ç«¯å®é™…åŠ è½½çš„ `item.notes` å€¼

---

**äº¤æ¥å®Œæ¯•ï¼ç¥æ–° AI åŠ©æ‰‹é¡ºåˆ©è§£å†³é—®é¢˜ï¼** ğŸ‰

